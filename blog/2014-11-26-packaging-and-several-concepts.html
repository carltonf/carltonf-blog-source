
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Packaging and Several Concepts - Crystal Sight</title>
  <meta name="author" content="Carl Xiong">

  
  <meta name="description" content="Intro The other day some of my colleagues were discussing about how to manage a
package. From what I heard: SUSE decides to use kernel's bundled &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://carltonf.github.io/blog/2014-11-26-packaging-and-several-concepts.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Crystal Sight" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Crystal Sight</a></h1>
  
    <h2>See further, but how far is far?</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:carltonf.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Packaging and Several Concepts</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-26'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://carltonf.github.io">Comments</a>
        
        |
        
        <a href="/blog/2014-11-26-packaging-and-several-concepts.org">SOURCE</a>
        

      </p>
    
  </header>


<div class="entry-content"><div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Intro</h2>
<div class="outline-text-2" id="text-1">
<p>
The other day some of my colleagues were discussing about how to manage a
package. From what I heard: <code>SUSE</code> decides to use kernel&#8217;s bundled <code>DRDB</code> module
instead of the version built out of <code>DRDB</code>&#8217;s source tree, which is dropped in
<code>DRDB</code>&#8217;s new version anyway. The package for this new <code>DRDB</code> is called
<code>DRDB-user</code> as it only contains the user-space part. The problem rises when a
user of older version of <code>SLE</code> (SUSE Linux Enterprise) decides to update to this
<code>DRDB-user</code>. <code>DRDB-user</code> is said to support some old versions, i.e. for these
versions you can mix up kernel modules from old <code>DRDB</code> package with newer
<code>DRDB-user</code>. The question is how to do the packaging? (I am totally ignorant
about <code>DRDB</code>, so the details might not be exact but the important point here is
packaging.)
</p>

<p>
I joined this discussion and throughout the course I&#8217;ve come to understand many
concepts more clearly than before: no overlap among packages, different
packaging methods, the meaning and differences between &#8220;Obsoletes&#8221; and
&#8220;Conflicts&#8221;
</p>

<p>
<!-- more -->
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">How to design packages?</h2>
<div class="outline-text-2" id="text-2">
<p>
The most intuitive and also best way should be just to divide the old <code>DRDB</code>
package into two: <code>DRDB-user</code> and <code>DRDB-km</code>. In this way, <code>DRDB-user</code> is just
the new package and can be upgraded separately if needed. So far so good. But
what if we don&#8217;t want to change the old package? Why? In retrospect, I think
it&#8217;s truly evil to have thought in that way, but back then they wanted to limit
the <span class="underline">maintenance burden</span> by reducing the number of packages.(Oh, I did support
this view&#x2026;, I understand&#x2026;) And then we fell into the rabbit hole.
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Packages should never overwrite each other.</h3>
<div class="outline-text-3" id="text-2-1">
<p>
The first idea was to have <code>DRDB-user</code> overwrite <code>DRDB</code>. This won&#8217;t work. No
matter how the dependency links are designed. Naive I was, I believed
carefully-crafted dependency would avoid any package breaks. Even cyclic
dependency was considered. As an afterthought, no overlap between packages is
actually the number one rule of packaging. In this case, just think of
re-installing <code>DRDB</code> after <code>DRDB-user</code> is installed.
</p>

<p>
However, this is the quickest solution. So if the use cases of mixing up old
<code>DRDB</code> with new <code>DRDB-user</code> are only few, then it might not be necessary to
design <code>DRDB-km</code>. To tell the sysadmin to be extra careful or add some warning
to the (un)installation/update message would be enough.
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Overwriting while packaging.</h3>
<div class="outline-text-3" id="text-2-2">
<p>
In the build&amp;install phrase of packaging, build old <code>DRDB</code> and also new
<code>DRDB-user</code>; install <code>DRDB</code> first, then <code>DRDB-user</code>, overwriting same files at
the same time. At last you pack everything up and name it <code>DRDB</code>. This method
should work in principle, but it&#8217;s bizarre and in reality we maintain a new
package even though it has an old name.
</p>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Several concepts</h3>
<div class="outline-text-3" id="text-2-3">
<p>
When talking about making new packages, we got confused on &#8220;Obsoletes&#8221; vs
&#8220;Conflicts&#8221;. I&#8217;ll put up two good references:
</p>

<p>
<a href="http://rpm5.org/community/rpm-users/0442.html">&#8220;Re: Conflicts vs Obsoletes&#8221; from rpm5.org</a>
</p>

<p>
<a href="https://wiki.archlinux.org/index.php/PKGBUILD#replaces">PKGBUILD#replaces</a> &#x2013; <code>replaces</code> is just the <code>Obsoletes</code> in <code>Arch</code>&#8217;s jargon.
</p>

<p>
In common, they all remove the designated packages. &#x2013; here is the cause we get
confused.
</p>

<p>
But have different purposes: <code>Obsoletes</code> prescribes an upgrade, so it&#8217;s
automatically done by the packaging system. <code>Conflicts</code> prevents installation
and these packages are surely not in the upgraded package list.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">After note</h2>
<div class="outline-text-2" id="text-3">
<p>
I didn&#8217;t follow this discussion later and don&#8217;t know what they&#8217;ve decided to do
in the end. In reflection, I realized how little I knew about packaging and how
real-life <span class="underline">politics</span> can affect engineering choice. The mentality to avoid
designing necessary new packages might come from this fact: whoever introduces
the package is likely to be responsible for maintaining it. And there are
already <b>A LOT</b> of packages at each one&#8217;s hand. Further, even the evil
package-overwriting method might be useful, if only one or two customers need
that special mix setup.
</p>
</div>
</div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Carl Xiong</span></span>

      




<time class='entry-date' datetime='2014-11-26'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:00 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/drdb/'>drdb</a>, <a class='category' href='/blog/categories/pkgbuild/'>pkgbuild</a>, <a class='category' href='/blog/categories/rpm/'>rpm</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014-11-21-arch-for-suse-package-development.html" title="Previous Post: Arch for SUSE package development">&laquo; Arch for SUSE package development</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014-11-26-packaging-and-several-concepts.html">Packaging and Several Concepts</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-11-21-arch-for-suse-package-development.html">Arch for SUSE Package Development</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-11-20-octopress-customization:-easy-blog-source-link.html">Octopress Customization: Easy Blog Source Link</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-11-19-org-octopress:-links.html">Org-octopress: Links</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-11-19-hello-and-self-introduction.html">Hello and Self-Introduction</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/carltonf">@carltonf</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'carltonf',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
  <h1>Category Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/arch-linux' style='font-size: 130.0%; margin: 1%'>arch_linux</a> <a href='/blog/categories/drdb' style='font-size: 130.0%; margin: 1%'>drdb</a> <a href='/blog/categories/emacs' style='font-size: 130.0%; margin: 1%'>emacs</a> <a href='/blog/categories/emacs-lisp' style='font-size: 130.0%; margin: 1%'>emacs-lisp</a> <a href='/blog/categories/jekyll' style='font-size: 130.0%; margin: 1%'>jekyll</a> <a href='/blog/categories/octopress' style='font-size: 160.0%; margin: 1%'>octopress</a> <a href='/blog/categories/org' style='font-size: 160.0%; margin: 1%'>org</a> <a href='/blog/categories/pkgbuild' style='font-size: 130.0%; margin: 1%'>pkgbuild</a> <a href='/blog/categories/rpm' style='font-size: 160.0%; margin: 1%'>rpm</a> <a href='/blog/categories/suse' style='font-size: 130.0%; margin: 1%'>suse</a> </span>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Carl Xiong -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'carltonf';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://carltonf.github.io/blog/2014-11-26-packaging-and-several-concepts.html';
        var disqus_url = 'http://carltonf.github.io/blog/2014-11-26-packaging-and-several-concepts.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
